From 24667685be584b860aa84bc205e1fbf01fca8261 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Steven!=20Ragnar=C3=B6k?= <steven@nuclearsandwich.com>
Date: Mon, 11 Sep 2017 12:59:47 -0400
Subject: [PATCH 06/11] Rebase from 'debian/r2b3/ament_cmake_core'

---
 debian/changelog                      |  7 -------
 debian/changelog.em                   |  7 +++++++
 debian/compat                         |  1 -
 debian/compat.em                      |  1 +
 debian/control                        | 13 -------------
 debian/control.em                     | 14 ++++++++++++++
 debian/gbp.conf                       |  3 ---
 debian/gbp.conf.em                    |  3 +++
 debian/{rules => rules.em}            | 23 ++++++++++-------------
 debian/source/format                  |  1 -
 debian/source/format.em               |  1 +
 debian/source/{options => options.em} |  3 ++-
 12 files changed, 38 insertions(+), 39 deletions(-)
 delete mode 100644 debian/changelog
 create mode 100644 debian/changelog.em
 delete mode 100644 debian/compat
 create mode 100644 debian/compat.em
 delete mode 100644 debian/control
 create mode 100644 debian/control.em
 delete mode 100644 debian/gbp.conf
 create mode 100644 debian/gbp.conf.em
 rename debian/{rules => rules.em} (73%)
 delete mode 100644 debian/source/format
 create mode 100644 debian/source/format.em
 rename debian/source/{options => options.em} (81%)

diff --git a/debian/changelog b/debian/changelog
deleted file mode 100644
index 9790aa1..0000000
--- a/debian/changelog
+++ /dev/null
@@ -1,7 +0,0 @@
-ros-r2b3-ament-cmake-core (0.0.2-0xenial) xenial; urgency=high
-
-  * Autogenerated, no changelog for this version found in CHANGELOG.rst.
-
- -- Dirk Thomas <dthomas@osrfoundation.org>  Mon, 11 Sep 2017 15:49:18 -0000
-
-
diff --git a/debian/changelog.em b/debian/changelog.em
new file mode 100644
index 0000000..3585909
--- /dev/null
+++ b/debian/changelog.em
@@ -0,0 +1,7 @@
+@[for change_version, change_date, changelog, main_name, main_email in changelogs]@(Package) (@(change_version)@(DebianInc)@(Distribution)) @(Distribution); urgency=high
+
+@(changelog)
+
+ -- @(main_name) <@(main_email)>  @(change_date)
+
+@[end for]
diff --git a/debian/compat b/debian/compat
deleted file mode 100644
index f11c82a..0000000
--- a/debian/compat
+++ /dev/null
@@ -1 +0,0 @@
-9
\ No newline at end of file
diff --git a/debian/compat.em b/debian/compat.em
new file mode 100644
index 0000000..b7f8528
--- /dev/null
+++ b/debian/compat.em
@@ -0,0 +1 @@
+@(debhelper_version)
\ No newline at end of file
diff --git a/debian/control b/debian/control
deleted file mode 100644
index fc7e41d..0000000
--- a/debian/control
+++ /dev/null
@@ -1,13 +0,0 @@
-Source: ros-r2b3-ament-cmake-core
-Section: misc
-Priority: extra
-Maintainer: Dirk Thomas <dthomas@osrfoundation.org>
-Build-Depends: debhelper (>= 9.0.0), cmake, ros-r2b3-ament-package
-Homepage: 
-Standards-Version: 3.9.2
-
-Package: ros-r2b3-ament-cmake-core
-Architecture: any
-Depends: ${shlibs:Depends}, ${misc:Depends}, cmake, ros-r2b3-ament-package
-Description: The core of the ament buildsystem in CMake.
- Several subcomponents provide specific funtionalities: * environment: provide prefix-level setup files * environment_hooks: provide package-level setup files and environment hooks * index: store information in an index and retrieve them without crawling * package_templates: templates from the ament_package Python package * symlink_install: use symlinks for CMake install commands
diff --git a/debian/control.em b/debian/control.em
new file mode 100644
index 0000000..7cbf65a
--- /dev/null
+++ b/debian/control.em
@@ -0,0 +1,14 @@
+Source: @(Package)
+Section: misc
+Priority: extra
+Maintainer: @(Maintainer)
+Build-Depends: debhelper (>= @(debhelper_version).0.0), @(', '.join(BuildDepends))
+Homepage: @(Homepage)
+Standards-Version: 3.9.2
+
+Package: @(Package)
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}, @(', '.join(Depends))
+@[if Conflicts]Conflicts: @(', '.join(Conflicts))@\n@[end if]@
+@[if Replaces]Replaces: @(', '.join(Replaces))@\n@[end if]@
+Description: @(Description)
diff --git a/debian/gbp.conf b/debian/gbp.conf
deleted file mode 100644
index 9e57b30..0000000
--- a/debian/gbp.conf
+++ /dev/null
@@ -1,3 +0,0 @@
-[git-buildpackage]
-upstream-tag=release/r2b3/ament_cmake_core/0.0.2-0
-upstream-tree=tag
diff --git a/debian/gbp.conf.em b/debian/gbp.conf.em
new file mode 100644
index 0000000..ad24a16
--- /dev/null
+++ b/debian/gbp.conf.em
@@ -0,0 +1,3 @@
+[git-buildpackage]
+upstream-tag=@(release_tag)
+upstream-tree=tag
diff --git a/debian/rules b/debian/rules.em
similarity index 73%
rename from debian/rules
rename to debian/rules.em
index 67054f2..9c9604d 100755
--- a/debian/rules
+++ b/debian/rules.em
@@ -13,31 +13,28 @@ export DH_VERBOSE=1
 #  https://code.ros.org/trac/ros/ticket/2977
 #  https://code.ros.org/trac/ros/ticket/3842
 export LDFLAGS=
-export PKG_CONFIG_PATH=/opt/ros/r2b3/lib/pkgconfig
+export PKG_CONFIG_PATH=@(InstallationPrefix)/lib/pkgconfig
 # Explicitly enable -DNDEBUG, see:
 # 	https://github.com/ros-infrastructure/bloom/issues/327
 export DEB_CXXFLAGS_MAINT_APPEND=-DNDEBUG
 
-# Needed to bootstrap since the ros_workspace package does not yet exist.
-export PYTHONPATH=/opt/ros/r2b3/lib/python3.5/site-packages
-
 %:
-	dh $@ -v --buildsystem=cmake
+	dh $@@ -v --buildsystem=cmake
 
 override_dh_auto_configure:
 	# In case we're installing to a non-standard location, look for a setup.sh
 	# in the install tree that was dropped by catkin, and source it.  It will
 	# set things like CMAKE_PREFIX_PATH, PKG_CONFIG_PATH, and PYTHONPATH.
-	if [ -f "/opt/ros/r2b3/setup.sh" ]; then . "/opt/ros/r2b3/setup.sh"; fi && \
+	if [ -f "@(InstallationPrefix)/setup.sh" ]; then . "@(InstallationPrefix)/setup.sh"; fi && \
 	dh_auto_configure -- \
-		-DCMAKE_INSTALL_PREFIX="/opt/ros/r2b3" \
-		-DAMENT_PREFIX_PATH="/opt/ros/r2b3"
+		-DCMAKE_INSTALL_PREFIX="@(InstallationPrefix)" \
+		-DAMENT_PREFIX_PATH="@(InstallationPrefix)"
 
 override_dh_auto_build:
 	# In case we're installing to a non-standard location, look for a setup.sh
 	# in the install tree that was dropped by catkin, and source it.  It will
 	# set things like CMAKE_PREFIX_PATH, PKG_CONFIG_PATH, and PYTHONPATH.
-	if [ -f "/opt/ros/r2b3/setup.sh" ]; then . "/opt/ros/r2b3/setup.sh"; fi && \
+	if [ -f "@(InstallationPrefix)/setup.sh" ]; then . "@(InstallationPrefix)/setup.sh"; fi && \
 	dh_auto_build
 
 override_dh_auto_test:
@@ -45,19 +42,19 @@ override_dh_auto_test:
 	# in the install tree that was dropped by catkin, and source it.  It will
 	# set things like CMAKE_PREFIX_PATH, PKG_CONFIG_PATH, and PYTHONPATH.
 	echo -- Running tests. Even if one of them fails the build is not canceled.
-	if [ -f "/opt/ros/r2b3/setup.sh" ]; then . "/opt/ros/r2b3/setup.sh"; fi && \
+	if [ -f "@(InstallationPrefix)/setup.sh" ]; then . "@(InstallationPrefix)/setup.sh"; fi && \
 	dh_auto_test || true
 
 override_dh_shlibdeps:
 	# In case we're installing to a non-standard location, look for a setup.sh
 	# in the install tree that was dropped by catkin, and source it.  It will
 	# set things like CMAKE_PREFIX_PATH, PKG_CONFIG_PATH, and PYTHONPATH.
-	if [ -f "/opt/ros/r2b3/setup.sh" ]; then . "/opt/ros/r2b3/setup.sh"; fi && \
-	dh_shlibdeps -l$(CURDIR)/debian/ros-r2b3-ament-cmake-core//opt/ros/r2b3/lib/
+	if [ -f "@(InstallationPrefix)/setup.sh" ]; then . "@(InstallationPrefix)/setup.sh"; fi && \
+	dh_shlibdeps -l$(CURDIR)/debian/@(Package)/@(InstallationPrefix)/lib/
 
 override_dh_auto_install:
 	# In case we're installing to a non-standard location, look for a setup.sh
 	# in the install tree that was dropped by catkin, and source it.  It will
 	# set things like CMAKE_PREFIX_PATH, PKG_CONFIG_PATH, and PYTHONPATH.
-	if [ -f "/opt/ros/r2b3/setup.sh" ]; then . "/opt/ros/r2b3/setup.sh"; fi && \
+	if [ -f "@(InstallationPrefix)/setup.sh" ]; then . "@(InstallationPrefix)/setup.sh"; fi && \
 	dh_auto_install
diff --git a/debian/source/format b/debian/source/format
deleted file mode 100644
index 163aaf8..0000000
--- a/debian/source/format
+++ /dev/null
@@ -1 +0,0 @@
-3.0 (quilt)
diff --git a/debian/source/format.em b/debian/source/format.em
new file mode 100644
index 0000000..9666bf4
--- /dev/null
+++ b/debian/source/format.em
@@ -0,0 +1 @@
+3.0 (@(format))
diff --git a/debian/source/options b/debian/source/options.em
similarity index 81%
rename from debian/source/options
rename to debian/source/options.em
index 8bc9182..8c4c78b 100644
--- a/debian/source/options
+++ b/debian/source/options.em
@@ -1,5 +1,6 @@
+@[if format and format == 'quilt']@
 # Automatically add upstream changes to the quilt overlay.
 # http://manpages.ubuntu.com/manpages/trusty/man1/dpkg-source.1.html
 # This supports reusing the orig.tar.gz for debian increments.
 auto-commit
-
+@[end if]
-- 
2.7.4

